# -*- coding: utf-8 -*-
"""Project 68.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1B7qtf9VWr8SW1_y4PUSCgGVae2qLhpp5

### Instructions

---

#### Goal of the Project

This project is designed for you to practice and solve the activities that are based on the concepts covered in the following lessons:

 1. Multiple linear regression - Introduction
 2. Car Prediction - Data exploration

---

#### Getting Started:

1. Click on this link to open the Colab file for this project.

  https://colab.research.google.com/drive/17usPH3PAJ7uBggEMReXQdVkrVJZaxaXU
  
2. Create a duplicate copy of the Colab file as described below.

  - Click on the **File menu**. A new drop-down list will appear.

   <img src='https://student-datasets-bucket.s3.ap-south-1.amazonaws.com/images/lesson-0/0_file_menu.png' width=500>

  - Click on the **Save a copy in Drive** option. A duplicate copy will get created. It will open up in the new tab on your web browser.

  <img src='https://student-datasets-bucket.s3.ap-south-1.amazonaws.com/images/lesson-0/1_create_colab_duplicate_copy.png' width=500>

3. After creating the duplicate copy of the notebook, please rename it in the **YYYY-MM-DD_StudentName_Project68** format.

4. Now, write your code in the prescribed code cells.

---

### Problem Statement

The most important factor for an Insurance Company is to determine what premium charges must be paid by an individual. The charges depend on various factors like age, gender, income, etc.

Build a model that is capable of predicting the insurance charges a person has to pay depending on the given features using multiple linear regression.

---

### List of Activities

**Activity 1:** Analysing the Dataset

**Activity 2:** Feature Encoding

**Activity 3:** Exploratory Data Analysis

**Activity 4:** Train-Test Split

**Activity 5:** Model Training using `statsmodels.api`

---

#### Activity 1:  Analysing the Dataset

- Create a Pandas DataFrame for **Insurance** dataset using the below link. This dataset consists of following columns:

|Field|Description|
|---:|:---|
|age|Age of primary beneficiary|
|sex|Insurance contractor gender, female or male|
|bmi|Body mass index|
|children|Number of children covered by health insurance/number of dependents|
|region|Beneficiary's residential area in the US, northeast, southeast, southwest, northwest|
|charges|Individual medical costs billed by health insurance|


  **Dataset Link:** https://s3-student-datasets-bucket.whjr.online/whitehat-ds-datasets/insurance_dataset.csv

- Print the first five rows of the dataset. Check for null values and treat them accordingly.

- Create a regression plot with `age` on X-axis and `charges` on Y-axis to identify the relationship between these two attributes.
"""

# Import modules
import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt

# Load the dataset
df = pd.read_csv('https://s3-student-datasets-bucket.whjr.online/whitehat-ds-datasets/insurance_dataset.csv')
# Print first five rows using head() function
df.head()

# Check if there are any null values. If any column has null values, treat them accordingly
df.isnull().sum()

# Print the information about the dataset
df.info()

"""----

#### Activity 2 : Feature Encoding

The `sex` and `region` columns are categorical attributes. Convert these attributes into numerical ones so that they can be used for linear regression analysis using `map()` function.

- Map the following values for the `sex` column:

  - `male` to `0`
  - `female` to `1`

- Map the following values for the `region` column:

 - `southeast` to `1`
 - `southwest` to `2`
 - `northeast` to `3`
 - `northwest` to `4`
"""

# Count the occurrence of each value in the 'sex' column.
df['sex'].value_counts()

# Use the 'map()' function to replace values in 'sex' column to their corresponding numeric values.
words = { "male" : 0 , "female" : 1 }

df['sex'] = df['sex'].map(words)

# Again count the occurrence of each value in the 'sex' column to verify whether all values are correctly mapped
df['sex'].value_counts()

# Count the occurrence of each value in the 'region' column.
df['region'].value_counts()

# Use the 'map()' function to replace a value in the 'region' column to their corresponding numeric values.
region = { "southeast" : 1 , "southwest" : 2,"northeast": 3 , "northwest" : 4 }

df['region'] = df['region'].map(region)

# Again count the occurrence of each value in the 'region' column to verify whether all values are correctly mapped
df['region'].value_counts()

"""---

#### Activity 3: Exploratory Data Analysis


Create the heat-map to look into the correlation of the features
"""

# Draw a correlation heatmap between the features.
plt.figure(figsize = (20, 5), dpi = 96)
plt.title("Heatmap between Features ")
sns.heatmap(df.corr(), annot=True)
plt.show()

"""---

#### Activity 4: Train-Test Split


Split the dataset into training set and test set such that the training set contains 67% of the instances and the remaining instances will become the test set and keep the `charges` as the target variables.
"""

# Split the 'df' Dataframe into the train and test sets.
from sklearn.model_selection import train_test_split
train_df,test_df = train_test_split(df,test_size = 0.33, random_state = 42)

# Create separate data-frames for the feature and target variables for both the train and test sets.
feature = list(df.columns)
feature.remove('charges')
X_train = df[feature]
y_train = df['charges']
X_test = df[feature]
y_test = df['charges']

"""---

#### Activity 5: Model Training using `statsmodels.api`

Now build a multiple linear regression model using the `statsmodels.api` module.
Also, print the summary of the linear regression model built.
"""

#  Build a linear regression model using all the features to predict insurance charges.
import statsmodels.api as sm

X_train_sm = sm.add_constant(X_train)

lr = sm.OLS( y_train , X_train_sm ).fit()
lr.params

# Print the summary of the linear regression report.
print(lr.summary())

"""**Q:** What is the $R^2$ value?

**A:** The value of $R^2$ is 0.412 .


**Q:** Is there multicollinearity in the model?

**A:** There is no collinearity in the model .

---

### Submitting the Project:

1. After finishing the project, click on the **Share** button on the top right corner of the notebook. A new dialog box will appear.

  <img src='https://student-datasets-bucket.s3.ap-south-1.amazonaws.com/images/project-share-images/2_share_button.png' width=500>

2. In the dialog box, make sure that '**Anyone on the Internet with this link can view**' option is selected and then click on the **Copy link** button.

   <img src='https://student-datasets-bucket.s3.ap-south-1.amazonaws.com/images/project-share-images/3_copy_link.png' width=500>

3. The link of the duplicate copy (named as **YYYY-MM-DD_StudentName_Project68**) of the notebook will get copied

   <img src='https://student-datasets-bucket.s3.ap-south-1.amazonaws.com/images/project-share-images/4_copy_link_confirmation.png' width=500>

4. Go to your dashboard and click on the **My Projects** option.
   
   <img src='https://student-datasets-bucket.s3.ap-south-1.amazonaws.com/images/project-share-images/5_student_dashboard.png' width=800>

  <img src='https://student-datasets-bucket.s3.ap-south-1.amazonaws.com/images/project-share-images/6_my_projects.png' width=800>

5. Click on the **View Project** button for the project you want to submit.

   <img src='https://student-datasets-bucket.s3.ap-south-1.amazonaws.com/images/project-share-images/7_view_project.png' width=800>

6. Click on the **Submit Project Here** button.

   <img src='https://student-datasets-bucket.s3.ap-south-1.amazonaws.com/images/project-share-images/8_submit_project.png' width=800>

7. Paste the link to the project file named as **YYYY-MM-DD_StudentName_Project68** in the URL box and then click on the **Submit** button.

   <img src='https://student-datasets-bucket.s3.ap-south-1.amazonaws.com/images/project-share-images/9_enter_project_url.png' width=800>

---
"""